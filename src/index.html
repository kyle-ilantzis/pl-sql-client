<!--
	pl-sql-client - Query many database at once
    Copyright (C) 2015  Kyle Ilantzis

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->

<!doctype html!>

<head>
	<script src="app:/_/libs/react.js"></script>
	<script src="app:/_/libs/JSXTransformer.js"></script>
<head>
<body>
	<script type="text/jsx">

		var DB_TYPES = ["MYSQL","Postgres","SQLite3"]

		var DbTypeSpinner = React.createClass({
			render: function() {

				var createOption = function(db,i) {
					return <option key={i}>{db}</option>;
				};

				return <select>
					{ createOption("",-1) }
					{ DB_TYPES.map(createOption) }
				</select>;
			}
		});

		var DbItem = React.createClass({

			onEdit: function() {
				if (this.props.onEdit) {
					this.props.onEdit(this.props.id);
				}
			},

			onDelete: function() {
				if (this.props.onDelete) {
					this.props.onDelete(this.props.id);
				}
			},

			render: function() {
				return <div>
					<p>{this.props.url}</p>
					<p>{this.props.dbType}</p>
					<a href="#" onClick={this.onEdit}>E</a>
					<a href="#" onClick={this.onDelete}>D</a>
				</div>;
			}
		});

		var DbEditItem = React.createClass({
			render: function() {
				return <div>
					<input type="text" value={this.props.url}/>
					<DbTypeSpinner dbType={this.props.dbType}/>
					<a>S</a>
					<a>C</a>
				</div>;
			}
		});

		var DbList = React.createClass({
			getInitialState: function() {
				return { dbs: [
					{url:"URL_1", dbType: "MYSQL"},
					{url:"URL_2", dbType: "Postgres"}
				]};
			},

			onEdit: function() {
				console.log("on edit");
			},

			onDelete: function() {
				console.log("on delete");
			},

			render: function() {

				var that = this;

				var createDbItem = function(db,i) {
					return <DbItem key={i} id={i} url={db.url} dbType={db.dbType} onEdit={that.onEdit} onDelete={that.onDelete}/>
				};

				return <div>
					{this.state.dbs.map(createDbItem)}
					<DbEditItem key={"add"} id={"add"}/>
				</div>;
			}
		});

		React.render(<DbList/>,document.body);
	</script>
	<script type="text/JavaScript">

	var MultiQuery = require('./backend/multiquery.js');
	var multiquery = new MultiQuery()

	multiquery.query().then(function(result) {
		// TODO @kyle-ilantzis Implements me!
		console.log(result);
	});
	
	</script>
</body>
